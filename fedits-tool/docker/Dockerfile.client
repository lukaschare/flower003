FROM python:3.11-slim

WORKDIR /app

# 第一步：仅仅拷贝 requirements.txt
COPY requirements.txt .

# 第二步：强制安装 CPU 版本的 PyTorch
RUN pip install --no-cache-dir torch==2.2.0 torchvision==0.17.0 --index-url https://download.pytorch.org/whl/cpu

# 第三步：安装其余依赖
RUN pip install --no-cache-dir -r requirements.txt

# 第四步：拷贝项目代码
COPY . /app

# Client 不需要 EXPOSE 8080，直接运行即可
CMD ["python", "-u", "fl/client.py"]