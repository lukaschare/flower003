version: "3.9"

services:
  fl_server:
    build:
      context: ..
      dockerfile: docker/Dockerfile.server
    container_name: fl_server
    ports:
      - "8080:8080"
    environment:
      # output
      OUT_DIR: outputs

      # Veins mode: mock first, later change to rpc
      VEINS_MODE: mock
      VEINS_HOST: 127.0.0.1
      VEINS_PORT: 9999

      # scenario
      MAP_SIZE_M: 1000
      NUM_VEH: 100
      RSU_X_M: 500
      RSU_Y_M: 500
      RSU_R_M: 300

      # FL
      SEED: 42
      ROUNDS: 5
      M: 10
      DEADLINE_S: 25

      # model sizes (bytes)
      MODEL_DOWN_BYTES: 2000000
      MODEL_UP_BYTES: 2000000

      # carbon + comm power model
      CI_G_PER_KWH: 200
      P_RX_W: 1.0
      P_TX_W: 1.5

      # bind
      SERVER_ADDR: 0.0.0.0:8080
    volumes:
      - ../outputs:/app/outputs

  fl_client_01:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_01
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client01
      # compute mock knobs
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.1

  fl_client_02:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_02
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client02
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.2

  fl_client_03:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_03
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client03
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.0

  fl_client_04:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_04
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client04
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.05

  fl_client_05:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_05
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client05
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.15

  fl_client_06:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_06
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client06
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.25

  fl_client_07:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_07
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client07
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.05

  fl_client_08:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_08
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client08
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.12

  fl_client_09:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_09
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client09
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.0

  fl_client_10:
    build:
      context: ..
      dockerfile: docker/Dockerfile.client
    container_name: fl_client_10
    depends_on: [fl_server]
    environment:
      SERVER_ADDR: fl_server:8080
      CLIENT_ID: client10
      P_COMP_W: 18
      CI_G_PER_KWH: 200
      SLEEP_SCALE: 0.18
