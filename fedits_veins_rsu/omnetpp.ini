[General]
cmdenv-express-mode = false # 方便调试，观察 barrier 阻塞时的日志输出
cmdenv-autoflush = true
cmdenv-status-frequency = 1s
**.cmdenv-log-level = info

image-path = ../../images

network = RSUExampleScenario
# network = org.car2x.veins.examples.fedits_veins_rsu.RSUExampleScenario



##########################################################
#            Simulation parameters                       #
##########################################################
# debug-on-errors = true
debug-on-errors = false

print-undisposed = true

# 建议改成 5000s 或者更久，确保覆盖所有训练轮次
sim-time-limit = 5000s
#sim-time-limit = 200s

**.scalar-recording = true
**.vector-recording = true

# 建议扩大到 4000 或 5000，与 Docker 的 MAP_SIZE_M 保持一致或更大
*.playgroundSizeX = 4000m
*.playgroundSizeY = 4000m

# *.playgroundSizeX = 2500m
# *.playgroundSizeY = 2500m
*.playgroundSizeZ = 50m # 3D 模拟，Z 轴高度设置为 50m，足够覆盖车辆和 RSU 的高度差


# =======================================================
# 将 FedITS 配置移到这里，属于 [General]，对所有模式生效
# =======================================================
# --- FedITS ControlServer (RPC) ---
*.control.port = 10001

# *.control.rsuX = 500
# *.control.rsuY = 500

*.control.rsuX = 2000
*.control.rsuY = 2000

# *.control.rsuR = 300
*.control.rsuR = 3000 # 也可以测试更大范围的覆盖


*.control.stepS = 0.1
*.control.maxGoodputMbps = 12
*.control.minGoodputMbps = 0.5
*.control.alpha = 2.0
*.control.baseRttMs = 10
# =======================================================

##########################################################
# Annotation parameters                                  #
##########################################################
*.annotations.draw = true

##########################################################
# Obstacle parameters                                    #
##########################################################
*.obstacles.obstacles = xmldoc("config.xml", "//AnalogueModel[@type='SimpleObstacleShadowing']/obstacles")

##########################################################
#            TraCIScenarioManager parameters             #
##########################################################
*.manager.updateInterval = 1s
*.manager.host = "localhost" # SUMO 和 Veins 运行在同一台机器上
*.manager.port = 9999 # SUMO 的 TraCI 端口，确保与 SUMO 启动命令中的 --remote-port 参数一致
*.manager.autoShutdown = true
*.manager.launchConfig = xmldoc("erlangen.launchd.xml")

##########################################################
#                       RSU SETTINGS                     #
#                                                        #
#                                                        #
##########################################################
*.rsu[0].mobility.x = 2000
*.rsu[0].mobility.y = 2000
*.rsu[0].mobility.z = 3

*.rsu[*].applType = "TraCIDemoRSU11p"
*.rsu[*].appl.headerLength = 80 bit
*.rsu[*].appl.sendBeacons = false
*.rsu[*].appl.dataOnSch = false
*.rsu[*].appl.beaconInterval = 1s
*.rsu[*].appl.beaconUserPriority = 7
*.rsu[*].appl.dataUserPriority = 5
*.rsu[*].nic.phy80211p.antennaOffsetZ = 0 m

##########################################################
#            11p specific parameters                     #
#                                                        #
#                    NIC-Settings                        #
##########################################################
*.connectionManager.sendDirect = true
*.connectionManager.maxInterfDist = 2600m
*.connectionManager.drawMaxIntfDist = false

*.**.nic.mac1609_4.useServiceChannel = false

*.**.nic.mac1609_4.txPower = 20mW
*.**.nic.mac1609_4.bitrate = 6Mbps
*.**.nic.phy80211p.minPowerLevel = -110dBm

*.**.nic.phy80211p.useNoiseFloor = true
*.**.nic.phy80211p.noiseFloor = -98dBm

*.**.nic.phy80211p.decider = xmldoc("config.xml")
*.**.nic.phy80211p.analogueModels = xmldoc("config.xml")
*.**.nic.phy80211p.usePropagationDelay = true

*.**.nic.phy80211p.antenna = xmldoc("antenna.xml", "/root/Antenna[@id='monopole']")
*.node[*].nic.phy80211p.antennaOffsetY = 0 m
*.node[*].nic.phy80211p.antennaOffsetZ = 1.895 m

##########################################################
#                      App Layer                         #
##########################################################
*.node[*].applType = "TraCIDemo11p"
*.node[*].appl.headerLength = 80 bit
*.node[*].appl.sendBeacons = false
*.node[*].appl.dataOnSch = false
*.node[*].appl.beaconInterval = 1s

##########################################################
#                      Mobility                          #
##########################################################
*.node[*].veinsmobility.x = 0
*.node[*].veinsmobility.y = 0
*.node[*].veinsmobility.z = 0
*.node[*].veinsmobility.setHostSpeed = false
*.node[*0].veinsmobility.accidentCount = 1
*.node[*0].veinsmobility.accidentStart = 73s
*.node[*0].veinsmobility.accidentDuration = 50s

[Config Default]

[Config WithBeaconing]
*.rsu[*].appl.sendBeacons = true
*.node[*].appl.sendBeacons = true

[Config WithChannelSwitching]
*.**.nic.mac1609_4.useServiceChannel = true
*.node[*].appl.dataOnSch = true
*.rsu[*].appl.dataOnSch = true

# add new configuration for FedITS ControlServer (RPC)
# --- FedITS ControlServer (RPC) ---
*.control.port = 10001

# RSU coverage gate (app-layer distance)
*.control.rsuX = 2000
*.control.rsuY = 2000
*.control.rsuR = 3000

# MUST match TraCI/SUMO step length (typical in RSU example is 0.1s)
*.control.stepS = 0.1

# MVP goodput model (tunable)
*.control.maxGoodputMbps = 12
*.control.minGoodputMbps = 0.5
*.control.alpha = 2.0
*.control.baseRttMs = 10

# (建议) 用 Cmdenv 跑，barrier 阻塞时 Qtenv 会“像卡死”
# cmdenv-express-mode = true
cmdenv-express-mode = false # 方便调试，观察 barrier 阻塞时的日志输出
